<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://github.com/BioKT/PLUMED-docs/metadynamics/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Metadynamics - BioKT-PLUMED-docs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Metadynamics";
        var mkdocs_page_input_path = "metadynamics.md";
        var mkdocs_page_url = "/BioKT/PLUMED-docs/metadynamics/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> BioKT-PLUMED-docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../setup/">Setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../umbrella/">Umbrella sampling</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Metadynamics</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#alanine-dipeptide-in-vacuum">Alanine dipeptide in vacuum</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../replicas/">Multiple replicas</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../dipc/">PLUMED@DIPC</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">BioKT-PLUMED-docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Metadynamics</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p><script
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
  type="text/javascript">
</script>
</p>
<h2 id="metadynamics-simulations-using-plumed">Metadynamics simulations using PLUMED</h2>
<p>One of the key functionalities from PLUMED is the possibility
of running simulations using metadynamics. The contents from
this section are borrowed from <a href="https://www.plumed.org/doc-v2.7/user-doc/html/masterclass-21-4.html">masterclass 
21.4</a>, 
where the methodology is introduced in simple terms.</p>
<h3 id="alanine-dipeptide-in-vacuum">Alanine dipeptide in vacuum</h3>
<p>To run this example, you will need the input files in the <code>data</code>
folder from this repository. Then, write a <code>plumed.dat</code> file
with the following contents</p>
<pre><code>MOLINFO STRUCTURE=dialaA.pdb
phi: TORSION ATOMS=@phi-2
psi: TORSION ATOMS=@psi-2

metad: METAD ARG=phi ...
   PACE=500 HEIGHT=1.2 BIASFACTOR=8
   SIGMA=0.3
   FILE=HILLS GRID_MIN=-pi GRID_MAX=pi
...
PRINT ARG=phi,psi FILE=colvarA.dat STRIDE=10
</code></pre>
<p>The key difference with umbrella sampling is that we are biasing 
with the <code>METAD</code> action. This allows us to explore the whole Ramachandran
map in a single run. </p>
<p>Again, we can simply run our simulation using the usual Gromacs command
with an additional <code>-plumed</code> flag</p>
<pre><code>foo@bar:~$ gmx mdrun -s topolA.tpr --deffnm metadA -plumed plumed.dat -nsteps 10000000
</code></pre>
<p>The most important differences come in the analysis. The simulation 
has generated a file <code>HILLS</code> including the information corresponding
to the adaptive biases added during the simulation. We can estimate 
the free energy surface on the biasing coordinate using the <code>sum_hills</code>
command</p>
<pre><code>foo@bar:~$ plumed sum_hills --hills HILLS --stride 500 --mintozero
</code></pre>
<p>This results in a series of files winth free energy surfaces on the
collective variable with increasingly large amounts of data. Hopefully, 
this will show that the free energy estimation is well converged. </p>
<p>Additionally, we can use the <code>driver</code>, for more analysis. For example,
we can write the following analysis script to reweight the simulation 
data and obtain the energy surface not only on the biased coordinate
but also on other coordinates (in this case, the psi torsion angle)</p>
<pre><code>MOLINFO STRUCTURE=dialaA.pdb
phi: TORSION ATOMS=@phi-2
psi: TORSION ATOMS=@psi-2
metad: METAD ARG=phi ...
   PACE=500 HEIGHT=1.2 BIASFACTOR=8
   SIGMA=0.3
   FILE=HILLS GRID_MIN=-pi GRID_MAX=pi
   RESTART=YES
...
as: REWEIGHT_BIAS ARG=metad.bias
hhphi: HISTOGRAM ARG=phi STRIDE=50 GRID_MIN=-pi GRID_MAX=pi GRID_BIN=50 BANDWIDTH=0.05 LOGWEIGHTS=as
hhpsi: HISTOGRAM ARG=psi STRIDE=50 GRID_MIN=-pi GRID_MAX=pi GRID_BIN=50 BANDWIDTH=0.05 LOGWEIGHTS=as
ffphi: CONVERT_TO_FES GRID=hhphi
ffpsi: CONVERT_TO_FES GRID=hhpsi
DUMPGRID GRID=ffphi FILE=ffphi.dat
DUMPGRID GRID=ffpsi FILE=ffpsi.dat
PRINT ARG=phi,psi,metad.bias FILE=colvar_reweight.dat STRIDE=1
</code></pre>
<p>Then, on the command line, we run</p>
<pre><code class="language-bash">foo@bar:~$ plumed driver --mf_xtc metadA.xtc --plumed plumed_reweight.dat --kt 2.494339
</code></pre>
<p>The results are output to the <code>ffphi.dat</code> and <code>ffpsi.dat</code> files, the latter
containing a notably noisy free energy landscape. </p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../umbrella/" class="btn btn-neutral float-left" title="Umbrella sampling"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../replicas/" class="btn btn-neutral float-right" title="Multiple replicas">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../umbrella/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../replicas/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
